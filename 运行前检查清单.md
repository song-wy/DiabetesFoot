# 运行前检查清单

## ✅ 已完成的配置

### 1. Web.config 配置修复
- ✅ 添加了 `DefaultConnection` 连接字符串（用于 Identity 身份验证）
- ✅ 保留了 `DiabetesFootConnection` 连接字符串（用于业务数据）
- ✅ 移除了 `authentication mode="None"`（使用 OWIN 进行身份验证）

### 2. 数据库配置
- ✅ Identity 数据库：`aspnet-DiabetesFoot`（用于用户认证）
- ✅ 业务数据库：`DiabetesFootManagement`（用于患者、血糖、伤口、药物数据）

### 3. 代码修复
- ✅ 所有控制器方法已实现
- ✅ 所有视图文件已创建
- ✅ 数据模型已修复
- ✅ DbContext 配置已修复

## 🔍 运行前检查

### 1. 检查 Visual Studio
- [ ] Visual Studio 2019/2022 已安装
- [ ] .NET Framework 4.7.2 或更高版本已安装
- [ ] ASP.NET 和 Web 开发工作负载已安装

### 2. 检查 SQL Server LocalDB
- [ ] SQL Server LocalDB 已安装（通常随 Visual Studio 一起安装）
- [ ] LocalDB 实例正在运行

**检查方法**：
```powershell
# 在 PowerShell 中运行
sqllocaldb info MSSQLLocalDB
```

### 3. 检查项目文件
- [ ] 项目文件完整
- [ ] NuGet 包需要还原

**还原 NuGet 包**：
- 在 Visual Studio 中：右键点击解决方案 → 还原 NuGet 包
- 或者：工具 → NuGet 包管理器 → 程序包管理器控制台 → 运行 `Update-Package -Reinstall`

## 🚀 运行步骤

### 步骤1：打开项目
1. 打开 Visual Studio
2. 文件 → 打开 → 项目/解决方案
3. 选择 `DiabetesFoot.sln`

### 步骤2：还原 NuGet 包
1. 右键点击解决方案
2. 选择"还原 NuGet 包"
3. 等待包还原完成

### 步骤3：清理并重新生成
1. 生成 → 清理解决方案
2. 生成 → 重新生成解决方案
3. 检查输出窗口，确保没有错误

### 步骤4：检查数据库
1. 视图 → SQL Server 对象资源管理器
2. 尝试连接到 `(localdb)\MSSQLLocalDB`
3. 如果连接失败，参考"常见问题"部分

### 步骤5：运行项目
1. 按 `F5` 或点击"启动"按钮
2. 浏览器会自动打开
3. 首次运行时会自动创建数据库

## ⚠️ 可能遇到的问题

### 问题1：数据库连接失败

**错误信息**：
```
无法连接到数据库
```

**解决方法**：
1. 检查 SQL Server LocalDB 是否正在运行
2. 打开 SQL Server 配置管理器
3. 启动 SQL Server (MSSQLLocalDB) 服务
4. 或者在 Visual Studio 中：视图 → SQL Server 对象资源管理器 → 右键 → 添加 SQL Server → 输入 `(localdb)\MSSQLLocalDB`

### 问题2：表不存在错误

**错误信息**：
```
Invalid object name 'dbo.Patients'
或
Invalid object name 'dbo.WoundRecords'
```

**解决方法**：
1. **方法1（简单）**：删除 `App_Data` 文件夹中的所有数据库文件
   - 删除 `*.mdf` 和 `*.ldf` 文件
   - 重新运行项目，让 Entity Framework 自动创建数据库

2. **方法2（推荐）**：使用 Code First Migrations
   ```powershell
   # 在包管理器控制台中运行
   Enable-Migrations
   Add-Migration InitialCreate
   Update-Database
   ```

### 问题3：编译错误

**错误信息**：
```
找不到类型或命名空间名称
```

**解决方法**：
1. 检查是否所有 NuGet 包都已还原
2. 清理解决方案：生成 → 清理解决方案
3. 重新生成：生成 → 重新生成解决方案
4. 检查引用是否正确

### 问题4：身份验证错误

**错误信息**：
```
无法连接到 Identity 数据库
```

**解决方法**：
1. 检查 `Web.config` 中的 `DefaultConnection` 连接字符串
2. 确保 SQL Server LocalDB 正在运行
3. 删除 `App_Data` 文件夹中的 Identity 数据库文件
4. 重新运行项目，让 Identity 自动创建数据库

### 问题5：端口被占用

**错误信息**：
```
端口已被占用
```

**解决方法**：
1. 更改项目属性中的端口号
2. 或者关闭占用端口的其他应用程序
3. 或者在 `DiabetesFoot.csproj.user` 文件中修改端口

## 📋 首次运行后的操作

### 1. 注册账户
- 访问注册页面：`/Account/Register`
- 填写注册信息
- 密码要求：
  - 至少 6 个字符
  - 至少包含一个数字
  - 至少包含一个小写字母
  - 至少包含一个大写字母
  - 至少包含一个非字母数字字符

### 2. 登录
- 访问登录页面：`/Account/Login`
- 使用注册的账户登录

### 3. 测试功能
- 添加患者
- 添加血糖记录
- 添加伤口记录
- 添加药物记录

## 🔧 调试技巧

### 1. 使用断点
- 在代码中设置断点（F9）
- 运行调试（F5）
- 程序会在断点处暂停
- 可以查看变量值、调用堆栈等

### 2. 查看输出窗口
- 视图 → 输出
- 选择"调试"或"生成"
- 查看编译和运行时信息

### 3. 使用浏览器开发者工具
- 按 F12 打开浏览器开发者工具
- 查看控制台错误
- 查看网络请求
- 查看元素样式

## 📝 检查清单

运行项目前，请确保：

- [ ] Visual Studio 已安装
- [ ] .NET Framework 4.7.2 或更高版本已安装
- [ ] SQL Server LocalDB 已安装并运行
- [ ] NuGet 包已还原
- [ ] 项目已清理并重新生成
- [ ] 没有编译错误
- [ ] Web.config 配置正确
- [ ] 数据库连接字符串正确

## 🎯 下一步

项目运行成功后：
1. 测试所有功能
2. 检查数据库表是否正确创建
3. 测试用户注册和登录
4. 测试所有 CRUD 操作
5. 检查错误处理和验证

---

**创建时间**：2025年1月
**最后更新**：2025年1月

