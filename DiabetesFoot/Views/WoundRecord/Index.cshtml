@model IEnumerable<DiabetesFoot.Models.WoundRecord>

@{
    ViewBag.Title = "伤口护理 - " + ViewBag.PatientName;
}

<h2>@ViewBag.Title</h2>

<p>
    @Html.ActionLink("添加新记录", "Create", new { patientId = ViewBag.PatientId }, new { @class = "btn btn-primary" })
</p>

<!-- 愈合进度图表 -->
<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">伤口愈合进度</h3>
    </div>
    <div class="panel-body">
        <canvas id="healingChart" height="100"></canvas>
    </div>
</div>

<!-- 伤口记录表格 -->
<table class="table">
    <tr>
        <th>记录日期</th>
        <th>位置</th>
        <th>大小(cm²)</th>
        <th>状态</th>
        <th>照片</th>
        <th>操作</th>
    </tr>
    @foreach (var item in Model)
    {
        <tr>
            <td>@item.RecordDate.ToString("yyyy-MM-dd")</td>
            <td>@item.Position</td>
            <td>@item.Size</td>
            <td>@item.HealingStatus</td>
            <td>
                @if (!string.IsNullOrEmpty(item.PhotoPath))
                {
                    <a href="@item.PhotoPath" target="_blank">查看照片</a>
                }
            </td>
            <td>
                @Html.ActionLink("详情", "Details", new { id = item.WoundId }) |
                @Html.ActionLink("编辑", "Edit", new { id = item.WoundId }) |
                @Html.ActionLink("删除", "Delete", new { id = item.WoundId })
            </td>
        </tr>
    }
</table>

<!-- 返回患者列表 -->
@Html.ActionLink("返回患者列表", "Index", "Patient", null, new { @class = "btn btn-default" })

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        $(function() {
            var progressData = @Html.Raw(Json.Encode(ViewBag.HealingProgress));
            if (progressData) {
                var ctx = document.getElementById('healingChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: progressData.Labels,
                        datasets: [{
                            label: '伤口大小(cm²)',
                            data: progressData.Sizes,
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            tension: 0.1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: false
                            }
                        }
                    }
                });
            }
        });
    </script>
}